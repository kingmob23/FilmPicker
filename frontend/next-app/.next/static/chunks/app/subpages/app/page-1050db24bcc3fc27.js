(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[642],{7558:function(e,n,t){Promise.resolve().then(t.bind(t,6016))},5360:function(e,n,t){"use strict";var r=t(8646),i=t(7437),s=t(2265),o=t(9318);function a(){let e=(0,r._)(["\n  padding: 20px;\n  text-align: center;\n  background: #282c34;\n  color: white;\n  margin-bottom: 20px;\n"]);return a=function(){return e},e}let u=s.memo(()=>(0,i.jsx)(l,{children:(0,i.jsx)("h1",{children:"Film Picker"})}));u.displayName="Header",n.Z=u;let l=o.ZP.header(a())},9504:function(e,n,t){"use strict";t.d(n,{UsernamesProvider:function(){return o},X:function(){return s}});var r=t(7437),i=t(2265);let s=(0,i.createContext)(void 0),o=e=>{let{children:n}=e,[t,o]=(0,i.useState)([]);return(0,r.jsx)(s.Provider,{value:{usernames:t,setUsernames:o},children:n})}},6016:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return q}});var r=t(8646),i=t(7437),s=t(9318),o=t(5360),a=t(7753),u=t(6463),l=t(2265),c=t(9343),d=t(4245),m=t(9504);let p=async(e,n,t,r)=>{if(!n){t(!0),console.log("submitHandler: Submitting data:",e);try{let n={requestId:Date.now(),usernames:e.usernames.map(e=>({name:e.name,type:e.type,refresh:e.refresh}))};console.log("submitHandler: Gathered data:",JSON.stringify(n));let t=await fetch("/api/scrape/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(t.ok){let n=await t.json();console.log("submitHandler: Received result:",n);let i={usernames:JSON.stringify(e.usernames),intersection:JSON.stringify(n.intersection),intersectionLen:n.intersection_len},s=new URLSearchParams(i).toString();r.push("/subpages/results?".concat(s))}else{let e=await t.json();console.error("submitHandler: Failed to submit usernames:",e)}}catch(e){console.error("submitHandler: An error occurred while submitting usernames",e)}finally{t(!1)}}};function f(){let e=(0,r._)(["\n  display: flex;\n  align-items: center;\n  gap: 10px;\n"]);return f=function(){return e},e}function h(){let e=(0,r._)(["\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  gap: 5px;\n"]);return h=function(){return e},e}function x(){let e=(0,r._)(["\n  margin: 10px;\n  padding: 10px;\n  font-size: 16px;\n"]);return x=function(){return e},e}function g(){let e=(0,r._)(["\n  margin: 10px;\n  padding: 10px 20px;\n  font-size: 16px;\n  cursor: pointer;\n"]);return g=function(){return e},e}function v(){let e=(0,r._)(["\n  color: red;\n  font-size: 14px;\n  margin-top: -10px;\n"]);return v=function(){return e},e}var y=e=>{var n,t,r,s,o,a;let{control:u,register:l,index:d,field:m,remove:p,setTypeToLB:f,errors:h}=e,x=e=>(null==e?void 0:e.message)!==void 0;return(0,i.jsxs)(j,{children:[(0,i.jsx)(c.Qr,{name:"usernames.".concat(d,".type"),control:u,render:e=>{let{field:n}=e;return(0,i.jsxs)(b,{children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("label",{children:[(0,i.jsx)("input",{type:"radio",value:"KP",checked:"KP"===n.value,onChange:()=>{n.onChange("KP"),f(d)}}),"KP"]}),(0,i.jsxs)("label",{children:[(0,i.jsx)("input",{type:"radio",value:"LB",checked:"LB"===n.value,onChange:()=>n.onChange("LB")}),"LB"]})]}),(0,i.jsxs)("label",{children:[(0,i.jsx)("input",{type:"checkbox",...l("usernames.".concat(d,".refresh"))}),"Refresh"]})]})}}),(0,i.jsx)(c.Qr,{name:"usernames.".concat(d,".name"),control:u,render:e=>{let{field:n}=e;return(0,i.jsx)(P,{...n})}}),(0,i.jsx)(_,{type:"button",onClick:()=>p(d),children:"Delete"}),x(null===(t=h.usernames)||void 0===t?void 0:null===(n=t[d])||void 0===n?void 0:n.name)&&(0,i.jsx)(k,{children:h.usernames[d].name.message}),x(null===(s=h.usernames)||void 0===s?void 0:null===(r=s[d])||void 0===r?void 0:r.type)&&(0,i.jsx)(k,{children:h.usernames[d].type.message}),x(null===(a=h.usernames)||void 0===a?void 0:null===(o=a[d])||void 0===o?void 0:o.refresh)&&(0,i.jsx)(k,{children:h.usernames[d].refresh.message})]},m.id)};let j=s.ZP.div(f()),b=s.ZP.div(h()),P=s.ZP.input(x()),_=s.ZP.button(g()),k=s.ZP.span(v());function S(){let e=(0,r._)(["\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100vh;\n  gap: 20px;\n"]);return S=function(){return e},e}function Z(){let e=(0,r._)(["\n  margin: 10px;\n  padding: 10px 20px;\n  font-size: 16px;\n  cursor: pointer;\n"]);return Z=function(){return e},e}function C(){let e=(0,r._)(["\n  color: red;\n  font-size: 14px;\n"]);return C=function(){return e},e}let w=d.Ry().shape({usernames:d.IX().of(d.Ry().shape({name:d.Z_().required("Username is required"),type:d.Z_().oneOf(["LB","KP"]).required("Type is required"),refresh:d.O7()})).min(1,"At least one username is required")});var L=()=>{let{setUsernames:e}=(0,l.useContext)(m.X)||{setUsernames:()=>{}},n=(0,u.useRouter)(),[t,r]=(0,l.useState)(!1),[s,o]=(0,l.useState)(""),[d,f]=(0,l.useState)(""),{control:h,handleSubmit:x,formState:{errors:g},register:v,getValues:j,setValue:b}=(0,c.cI)({resolver:(0,a.X)(w),defaultValues:{usernames:[{name:"",type:"LB",refresh:!1}]}}),{fields:P,append:_,remove:k}=(0,c.Dq)({control:h,name:"usernames"}),S=e=>{o("Integration with kinopoisk is not yet working. CAPTCHA issue!"),b("usernames.".concat(e,".type"),"LB")};return(0,i.jsxs)(B,{children:[(0,i.jsx)("h1",{children:"Enter Usernames"}),(0,i.jsxs)("form",{onSubmit:x(i=>{r(!0),e(i.usernames);let s=setTimeout(()=>{f("The initial loading or update may take some time.")},1e3);p(i,t,r,n).finally(()=>{clearTimeout(s),r(!1),f("")})}),children:[P.map((e,n)=>(0,i.jsx)(y,{control:h,register:v,index:n,field:e,remove:k,setTypeToLB:S,errors:g},e.id)),s&&(0,i.jsx)(T,{children:s}),d&&(0,i.jsx)(T,{children:d}),(0,i.jsx)(O,{type:"button",onClick:()=>{var e,n;let t=null!==(e=j("usernames"))&&void 0!==e?e:[];""!==(null!==(n=t[t.length-1])&&void 0!==n?n:{name:"",type:"LB",refresh:!1}).name.trim()?(_({name:"",type:"LB",refresh:!1}),o("")):o("Please complete the current username field before adding a new one.")},children:"Add Username"}),(0,i.jsx)(O,{type:"submit",disabled:t,children:"Submit"})]})]})};let B=s.ZP.div(S()),O=s.ZP.button(Z()),T=s.ZP.p(C());function N(){let e=(0,r._)(["\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100vh;\n  gap: 20px;\n"]);return N=function(){return e},e}var q=()=>(0,i.jsxs)(H,{children:[(0,i.jsx)(o.Z,{}),(0,i.jsx)(L,{})]});let H=s.ZP.div(N())}},function(e){e.O(0,[268,445,971,23,744],function(){return e(e.s=7558)}),_N_E=e.O()}]);